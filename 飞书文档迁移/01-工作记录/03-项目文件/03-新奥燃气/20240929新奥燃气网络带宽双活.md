---
created: '2024-09-03 15:00:53'
feishu_url: https://wk5tnvpfe7.feishu.cn/docx/Y5Kyd6T4uoHY6SxV5ftccIk8nqe
modified: '2025-03-13 09:42:28'
source: feishu
title: 20240929新奥燃气网络带宽双活
---

20240929新奥燃气网络带宽双活
网络带宽的估算模型
（单中心内网带宽，同时存在1路语音机器人、1路文本机器人、1路助手访问、1路质检、1路陪练）
AICC座席->导航->大模型：
AICC座席->导航：音频格式一般pcma和pcmu，8k8bit，1s的双向流量就是2x8000×8 bit  = 128kbit/s
导航->大模型：文本格式按照通用JSON计算，考虑promt和上下文记忆，按照8k token计算 = 64kbit/s
AICC座席->文本->大模型：
AICC座席->文本：文本格式按照通用JSON计算，考虑promt和上下文记忆，按照8kt oken计算 = 64kbit/s
文本->大模型：文本格式按照通用JSON计算，考虑promt和上下文记忆，按照8kt oken计算 = 64kbit/s
AICC座席->助手->大模型：
AICC座席->助手：音频格式一般pcma和pcmu，8k8bit，1s的双向流量就是2x8000×8 bit  = 128Kbit/s
助手->大模型：文本格式按照通用JSON计算,考虑promt和上下文记忆，按照8ktoken计算 = 64kbit/s
带宽计算：409mbit/s
业务带宽：冗余到400mbit/s,1路并发，总体 = 380kbit/S。按照1000路计算=372mbit/s
AICC —> 各个应用 （业务文本、语音流量）= 271 kbit/s
冗余页面访问流量=64kbit/s
各个应用  -> 大模型 = 45 kbit/s
网络访问延时按照（要能够流畅访问页面最佳延时）<=25ms
数据同步的带宽：
当天业务量：按照1天30000桶电话计算
各个应用的持久化数据：单个应用单个并发15KB持久化数据，4*15=45KB = 50KB=400kbit * 3W = 11gbit
录音数据：按照平均通话时长 3分钟计算，1桶通话录音文件：8（bit）*8kHz*2（声道数）*180（秒）/（bit/Byte）=2.82 MB = 22.56 mbit * 30000 = 661gbit
按照5小时完成双中心数据同步：0.03733gbit/s = 37.33mbit/s
带宽计算

双活方案
异地双活的要求
异地双活方案：（不考虑某个中心某个组件全部宕机，如果考虑，交叉访问带宽上升，同时需要引入硬件路由设备）
可以通过分地域座席实现，单个中心内部独立运行
需要利用F5、SLB做IP Hash做座席访问划分地域\呼入号码区分区域
中间件的缓存数据每个中心独立使用
持久化数据做2个中心之间互相同步（需要各个组件做验证）
需要双向同步，各个应用数据库主键不能自增
同城双活、异地灾备（不考虑某个中心某个组件全部宕机，如果考虑，交叉访问带宽上升，同时需要引入硬件路由设备）
灾备数据做多个中心之间互相同步（需要各个组件做验证）
需要双向同步，各个应用数据库主键不能自增
id生成/解析服务：数据中心id + 时间戳 + 流水号
业务应用双写
系统灾备的切换方式
灾备手动切换
通过前置机，负载切换
冷备方案（minio\es\mongo\ck\mysql\doris）：使用脚本定时同步（每天凌晨），数据同步时效
minio：音频、报表文件
es：流程、知识片段
mongo：Docqa使用
ck：助手数据、外呼数据
mysql：业务数据
doris：报表数据
数据回写：主中心恢复后，使用脚本定时同步回写
同城双活的数据中间件依赖第三中心做仲裁保证高可用
疑问
业务同步带宽
当天业务量
各个应用的持久化数据
大模型的机器双中心机器是否双中心
大模型机器是在什么机房？地域在什么地方，带宽和延时（沈简）
应用到 大模型的：带宽：1G，<=25ms
promt大小？上下文记忆的报文限制？
座席职场座席、运营座席在什么位置（同城双活、异地灾备不考虑）
内网带宽多少？不用考虑
新奥是否有其他产品的类似的双中心、灾备的方案
AICC华为的CTI pool做了改造
是否有基础中间件的云服务？
代办
1、核心问题
两个机房的总体关系（双活、权重、请求分发策略）
都正常时的处理逻辑（用户请求引流到单机房，减少一致性问题机率）
单机房异常时的处理逻辑
A、异常的判断逻辑（什么情况才算单机房异常，需要停止引流）
B、异常时的流量控制
C、异常时双向同步有无中断？中断的同步如何恢复
D、什么情况才算恢复，才能重新引流

2、数据一致性问题
双向同步避免冲突
提升同步效率
数据同步机制、避免延迟影响
数据同步监控，有中断或延迟高时及时管控
两机房所有服务器时间同步，出现一致性问题时便于解决问题

3、成本控制
在架构上尽量精简
预算是多少？两机房后是否资源要翻倍？




